const LETUP_CONFIG={enableRealtimeNotifications:!0,enableRotatorNotifications:!0,maxToasts:3,rotatorInterval:5000,autoHideDelay:5000,rotatorDataLimit:10,scrollTriggerPoint:200,supabaseUrl:'https://tsaaphhxqbsknszartza.supabase.co',supabaseKey:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzYWFwaGh4cWJza25zemFydHphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE0MjEyNzAsImV4cCI6MjA1Njk5NzI3MH0.yQZgidrNuzheZ8oKgpWkl4n0Ha9WoJNbnIuu8IuhLaU',tableName:'notifications',showDismissButton:!1,productImageUrl:'https://placehold.co/64'};function addStyles(){if(document.getElementById('letup-toast-styles'))return;const style=document.createElement('style');style.id='letup-toast-styles';style.textContent=`#toast-container{max-width:432px;position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999}.toast{display:flex;align-items:center;background:linear-gradient(180deg,rgba(255,255,255,1)0%,rgba(9,175,237,0.08)100%);background-color:#fff;border-radius:24px;margin-bottom:12px;padding:14px 18px;box-shadow:0 0 0 1px #0e3f7e0f,0 1px 1px-0.5px #2a334608,0 2px 2px-1px #2a33460a,0 3px 3px-1.5px #2a33460a,0 5px 5px-2.5px #2a334608,0 10px 10px-5px #2a334608,0 24px 24px-8px #2a334608,rgb(23 43 99/3%)0 0 28px;min-width:300px;max-width:90vw;font-family:sans-serif;color:rgba(14,21,25,0.8);transition:all 0.3s ease}.payment-toast{padding:14px 18px;background:linear-gradient(180deg,rgb(255,255,255)0%,rgb(58,201,104,0.08)100%);background-color:#fff}.toast.show{opacity:1;transform:translateY(0)}.toast.hide{opacity:0;transform:translateY(-20px)}.toast-logo{width:64px;height:64px;object-fit:cover;margin-right:14px;background:#eee;flex-shrink:0}.toast-content{flex:1;max-width:300px;line-height:1.4;margin-left:15px}.toast-heading{font-size:14px;margin-bottom:4px}.toast-subtext span{color:#5b6e74;font-size:12px}.toast-subtext{display:flex;width:320px;justify-content:flex-start;align-items:flex-end}.toast-left{order:-1}.toast-right{display:flex;margin-left:auto;padding-right:20px}.toast-close{position:relative;top:-20px;left:11px;margin-left:8px;cursor:pointer;background:none;border:none;font-size:14px;color:#b4b4b4;flex-shrink:0;align-self:flex-start}.toast-close:hover{color:#000}.flip-container{perspective:1000px;width:64px;height:64px}.flip-img{width:100%;height:100%;position:relative;transform-style:preserve-3d;animation:flip 0.5s ease-in-out 1 forwards;animation-delay:1.5s}.flip-img-front,.flip-img-back{width:100%;height:100%;position:absolute;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;font-size:20px;color:white;border-radius:50%}.flip-img-front{}.flip-img-back{background-color:#FF5733;transform:rotateY(180deg)}.flip-img-back img{border-radius:50%}
@keyframes flip{0%{transform:rotateY(0deg)}
100%{transform:rotateY(180deg)}}`;document.head.appendChild(style)}
addStyles();(function loadConfigFromDataAttributes(){const scripts=document.getElementsByTagName('script');const currentScript=scripts[scripts.length-1];if(currentScript){if(currentScript.hasAttribute('data-enable-realtime')){LETUP_CONFIG.enableRealtimeNotifications=currentScript.getAttribute('data-enable-realtime')==='true'}
if(currentScript.hasAttribute('data-enable-rotator')){LETUP_CONFIG.enableRotatorNotifications=currentScript.getAttribute('data-enable-rotator')==='true'}
if(currentScript.hasAttribute('data-dismiss')){LETUP_CONFIG.showDismissButton=currentScript.getAttribute('data-dismiss')==='true'}
if(currentScript.hasAttribute('data-max-toasts')){const value=parseInt(currentScript.getAttribute('data-max-toasts'));if(!isNaN(value))LETUP_CONFIG.maxToasts=value}
if(currentScript.hasAttribute('data-rotator-interval')){const value=parseInt(currentScript.getAttribute('data-rotator-interval'));if(!isNaN(value))LETUP_CONFIG.rotatorInterval=value}
if(currentScript.hasAttribute('data-auto-hide-delay')){const value=parseInt(currentScript.getAttribute('data-auto-hide-delay'));if(!isNaN(value))LETUP_CONFIG.autoHideDelay=value}
if(currentScript.hasAttribute('data-rotator-limit')){const value=parseInt(currentScript.getAttribute('data-rotator-limit'));if(!isNaN(value))LETUP_CONFIG.rotatorDataLimit=value}
if(currentScript.hasAttribute('data-product-image')){LETUP_CONFIG.productImageUrl=currentScript.getAttribute('data-product-image')}
if(currentScript.hasAttribute('data-supabase-url')){LETUP_CONFIG.supabaseUrl=currentScript.getAttribute('data-supabase-url')}
if(currentScript.hasAttribute('data-supabase-key')){LETUP_CONFIG.supabaseKey=currentScript.getAttribute('data-supabase-key')}
if(currentScript.hasAttribute('data-table-name')){LETUP_CONFIG.tableName=currentScript.getAttribute('data-table-name')}
console.log("Notifications: Configured from data attributes",LETUP_CONFIG)}})();(function loadConfigFromContainer(){const container=document.getElementById('toast-container');if(!container)return;if(container.hasAttribute('data-enable-realtime')){LETUP_CONFIG.enableRealtimeNotifications=container.getAttribute('data-enable-realtime')==='true'}
if(container.hasAttribute('data-enable-rotator')){LETUP_CONFIG.enableRotatorNotifications=container.getAttribute('data-enable-rotator')==='true'}
if(container.hasAttribute('data-dismiss')){LETUP_CONFIG.showDismissButton=container.getAttribute('data-dismiss')==='true'}
if(container.hasAttribute('data-max-toasts')){const value=parseInt(container.getAttribute('data-max-toasts'));if(!isNaN(value))LETUP_CONFIG.maxToasts=value}
if(container.hasAttribute('data-rotator-interval')){const value=parseInt(container.getAttribute('data-rotator-interval'));if(!isNaN(value))LETUP_CONFIG.rotatorInterval=value}
if(container.hasAttribute('data-auto-hide-delay')){const value=parseInt(container.getAttribute('data-auto-hide-delay'));if(!isNaN(value))LETUP_CONFIG.autoHideDelay=value}
if(container.hasAttribute('data-rotator-limit')){const value=parseInt(container.getAttribute('data-rotator-limit'));if(!isNaN(value))LETUP_CONFIG.rotatorDataLimit=value}
if(container.hasAttribute('data-product-image')){LETUP_CONFIG.productImageUrl=container.getAttribute('data-product-image')}
if(container.hasAttribute('data-supabase-url')){LETUP_CONFIG.supabaseUrl=container.getAttribute('data-supabase-url')}
if(container.hasAttribute('data-supabase-key')){LETUP_CONFIG.supabaseKey=container.getAttribute('data-supabase-key')}
if(container.hasAttribute('data-table-name')){LETUP_CONFIG.tableName=container.getAttribute('data-table-name')}
console.log("Notifications: Configured from container attributes",LETUP_CONFIG)})();let supabaseLoaded=!1;let scrollHandler;let supabase;let realtimeSubscription;let rotatorData=[];let isRotatorRunning=!1;let rotatorTimeout=null;function loadLottiePlayer(){if(document.querySelector('script[src*="dotlottie-player"]')){return}
const script=document.createElement("script");script.src="https://cdn.jsdelivr.net/npm/@dotlottie/player-component/dist/dotlottie-player.min.js";document.head.appendChild(script)}
loadLottiePlayer();function lazyLoadSupabase(){if(supabaseLoaded)return;supabaseLoaded=!0;window.removeEventListener("scroll",scrollHandler);const script=document.createElement("script");script.src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js";script.onload=()=>{initSupabase()};document.head.appendChild(script)}
scrollHandler=()=>{if(window.scrollY>200){lazyLoadSupabase()}};window.addEventListener("scroll",scrollHandler);setTimeout(lazyLoadSupabase,1000);function initSupabase(){const{createClient}=window.supabase;const SUPABASE_URL=LETUP_CONFIG.supabaseUrl;const SUPABASE_ANON_KEY=LETUP_CONFIG.supabaseKey;supabase=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);console.log("Supabase initialized. Configuration:",{enableRealtime:LETUP_CONFIG.enableRealtimeNotifications,enableRotator:LETUP_CONFIG.enableRotatorNotifications,tableName:LETUP_CONFIG.tableName});if(LETUP_CONFIG.enableRealtimeNotifications){initRealtimeNotifications()}
if(LETUP_CONFIG.enableRotatorNotifications){initRotatorNotifications()}}
function initRealtimeNotifications(){console.log(`Initializing realtime notifications with table: ${LETUP_CONFIG.tableName}`);realtimeSubscription=supabase.channel('notifications-channel').on('postgres_changes',{event:'INSERT',schema:'public',table:LETUP_CONFIG.tableName,filter:'displayed=eq.false'},(payload)=>{handleRealtimeNotification(payload.new)}).subscribe()}
function handleRealtimeNotification(notification){const buyer=notification.buyer_name||"Seseorang";const product=notification.product_name||"produk ini";const createdAt=notification.created_at;const lastUpdatedAt=notification.last_updated_at||notification.created_at;updateNotificationDisplayed(notification.id);const isPaymentConfirmation=notification.event_type==='order.updated'&&notification.payment_status==='paid';if(isPaymentConfirmation){showPaymentConfirmationToast(buyer,product,createdAt,lastUpdatedAt)}else{const hhmm=createdAt?formatHoursMinutes(createdAt):"";showToast(buyer,product,hhmm,createdAt)}}
async function updateNotificationDisplayed(id){try{await supabase.from(LETUP_CONFIG.tableName).update({displayed:!0,last_updated_at:new Date().toISOString()}).eq('id',id)}catch(error){console.error("Error updating notification:",error)}}
function initRotatorNotifications(){fetchRotatorData().then(()=>{if(!isRotatorRunning&&rotatorData.length>0){isRotatorRunning=!0;showNextRotatorNotification()}});setInterval(fetchRotatorData,5*60*1000)}
async function fetchRotatorData(){try{const sevenDaysAgo=new Date();sevenDaysAgo.setDate(sevenDaysAgo.getDate()-7);const{data,error}=await supabase.from(LETUP_CONFIG.tableName).select('*').eq('event_type','order.updated').eq('payment_status','paid').gte('created_at',sevenDaysAgo.toISOString()).limit(LETUP_CONFIG.rotatorDataLimit);if(error){console.error("Error fetching rotator data:",error);return}
rotatorData=data||[];rotatorData.sort(()=>Math.random()-0.5);console.log(`Fetched ${rotatorData.length} entries for rotator notifications`);if(!isRotatorRunning&&rotatorData.length>0){isRotatorRunning=!0;showNextRotatorNotification()}}catch(err){console.error('Error fetching rotator data:',err)}}
async function updateNotificationDisplayed(id){try{await supabase.from(LETUP_CONFIG.tableName).update({displayed:!0,last_updated_at:new Date().toISOString()}).eq('id',id)}catch(error){console.error("Error updating notification:",error)}}
function showNextRotatorNotification(){if(rotatorData.length===0){isRotatorRunning=!1;return}
const item=rotatorData.shift();rotatorData.push(item);const buyer=item.buyer_name||'Seseorang';const productName=item.product_name||'produk ini';const createdAt=item.created_at;const lastUpdatedAt=item.last_updated_at||item.created_at;const toastEl=showPaymentConfirmationToast(buyer,productName,createdAt,lastUpdatedAt);setTimeout(()=>{hideToast(toastEl);rotatorTimeout=setTimeout(showNextRotatorNotification,LETUP_CONFIG.rotatorInterval)},LETUP_CONFIG.autoHideDelay)}
function formatHoursMinutes(dateString){const d=new Date(dateString);let hours=d.getHours();let minutes=d.getMinutes();if(hours<10)hours="0"+hours;if(minutes<10)minutes="0"+minutes;return `${hours}:${minutes}`}
function formatRelativeTime(dateString){const now=new Date();const date=new Date(dateString);const diffInSeconds=Math.floor((now-date)/1000);if(diffInSeconds<60){return"Baru saja"}else if(diffInSeconds<3600){const minutes=Math.floor(diffInSeconds/60);return `${minutes} menit lalu`}else if(diffInSeconds<86400){const hours=Math.floor(diffInSeconds/3600);return `${hours} jam lalu`}else{const days=Math.floor(diffInSeconds/86400);return `${days} hari lalu`}}
function formatIndonesianDay(dateString){const date=new Date(dateString);const dayIndex=date.getDay();const indonesianDays=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];return indonesianDays[dayIndex]}
function showToast(buyer,product,hhmm,timestamp){const container=document.getElementById("toast-container");if(container.children.length>=LETUP_CONFIG.maxToasts){container.removeChild(container.firstElementChild)}
const toastEl=document.createElement("div");toastEl.className="toast";const flipContainer=document.createElement("div");flipContainer.className="flip-container";const flipImg=document.createElement("div");flipImg.className="flip-img";const flipImgFront=document.createElement("div");flipImgFront.className="flip-img-front";const flipImgBack=document.createElement("div");flipImgBack.className="flip-img-back";const lottieEl=document.createElement("dotlottie-player");lottieEl.setAttribute("src","https://lottie.host/a5a44751-5f25-48fb-8866-32084a94469c/QSiPMensPK.lottie");lottieEl.setAttribute("background","transparent");lottieEl.setAttribute("speed","1");lottieEl.setAttribute("direction","1");lottieEl.setAttribute("playMode","normal");lottieEl.setAttribute("autoplay","");lottieEl.style.width="64px";lottieEl.style.height="64px";flipImgFront.appendChild(lottieEl);const imgEl=document.createElement("img");imgEl.src=LETUP_CONFIG.productImageUrl;imgEl.width=64;imgEl.height=64;imgEl.alt="Foto produk";flipImgBack.appendChild(imgEl);flipImg.appendChild(flipImgFront);flipImg.appendChild(flipImgBack);flipContainer.appendChild(flipImg);toastEl.appendChild(flipContainer);const contentEl=document.createElement("div");contentEl.className="toast-content";const headingEl=document.createElement("div");headingEl.className="toast-heading";headingEl.innerHTML=`${buyer} telah checkout <strong>${product}</strong>!`;contentEl.appendChild(headingEl);if(hhmm){const dayName=formatIndonesianDay(timestamp);const subtextEl=document.createElement("div");subtextEl.className="toast-subtext";subtextEl.innerHTML=`<div class="toast-left"><span>Baru saja</span></div><div class="toast-right"><span>${dayName}, ${hhmm}</span></div>`;contentEl.appendChild(subtextEl)}
toastEl.appendChild(contentEl);if(LETUP_CONFIG.showDismissButton){const closeBtn=document.createElement("button");closeBtn.className="toast-close";closeBtn.innerText="x";closeBtn.addEventListener("click",()=>{hideToast(toastEl)});toastEl.appendChild(closeBtn)}
container.appendChild(toastEl);requestAnimationFrame(()=>{toastEl.classList.add("show")});setTimeout(()=>hideToast(toastEl),LETUP_CONFIG.autoHideDelay);return toastEl}
function showPaymentConfirmationToast(buyer,product,timestamp,lastUpdatedAt){const container=document.getElementById("toast-container");if(container.children.length>=3){container.removeChild(container.firstElementChild)}
const toastEl=document.createElement("div");toastEl.className="toast payment-toast";const flipContainer=document.createElement("div");flipContainer.className="flip-container";const flipImg=document.createElement("div");flipImg.className="flip-img";const flipImgFront=document.createElement("div");flipImgFront.className="flip-img-front";const flipImgBack=document.createElement("div");flipImgBack.className="flip-img-back";const lottieEl=document.createElement("dotlottie-player");lottieEl.setAttribute("src","https://lottie.host/f6cd6d57-120a-4e02-bf2e-c06fd3292d66/kureTbkW4K.lottie");lottieEl.setAttribute("background","transparent");lottieEl.setAttribute("speed","1");lottieEl.setAttribute("direction","1");lottieEl.setAttribute("playMode","normal");lottieEl.setAttribute("autoplay","");lottieEl.style.width="64px";lottieEl.style.height="64px";flipImgFront.appendChild(lottieEl);const imgEl=document.createElement("img");imgEl.src=LETUP_CONFIG.productImageUrl;imgEl.width=64;imgEl.height=64;imgEl.alt="Foto produk";flipImgBack.appendChild(imgEl);flipImg.appendChild(flipImgFront);flipImg.appendChild(flipImgBack);flipContainer.appendChild(flipImg);toastEl.appendChild(flipContainer);const contentEl=document.createElement("div");contentEl.className="toast-content";const headingEl=document.createElement("div");headingEl.className="toast-heading";headingEl.innerHTML=`${buyer} telah membeli <strong>${product}</strong>!`;contentEl.appendChild(headingEl);const dayName=lastUpdatedAt?formatIndonesianDay(lastUpdatedAt):"";const subtextEl=document.createElement("div");subtextEl.className="toast-subtext";const relativeTime=formatRelativeTime(timestamp);const hhmm=lastUpdatedAt?formatHoursMinutes(lastUpdatedAt):"";subtextEl.innerHTML=`<div class="toast-left"><span>${relativeTime}</span></div><div class="toast-right"><span>${dayName}, ${hhmm}</span> </div>`;contentEl.appendChild(subtextEl);toastEl.appendChild(contentEl);if(LETUP_CONFIG.showDismissButton){const closeBtn=document.createElement("button");closeBtn.className="toast-close";closeBtn.innerText="x";closeBtn.addEventListener("click",()=>{hideToast(toastEl)});toastEl.appendChild(closeBtn)}
container.appendChild(toastEl);requestAnimationFrame(()=>{toastEl.classList.add("show")});setTimeout(()=>hideToast(toastEl),LETUP_CONFIG.autoHideDelay);return toastEl}
function hideToast(el){el.classList.remove("show");el.classList.add("hide");setTimeout(()=>{el.remove()},300)}
function showNextRotatorNotification(){if(rotatorData.length===0){isRotatorRunning=!1;return}
const item=rotatorData.shift();rotatorData.push(item);const buyer=item.buyer_name||'Seseorang';const productName=item.product_name||'produk ini';const createdAt=item.created_at;const lastUpdatedAt=item.last_updated_at||item.created_at;const toastEl=showPaymentConfirmationToast(buyer,productName,createdAt,lastUpdatedAt);setTimeout(()=>{hideToast(toastEl);rotatorTimeout=setTimeout(showNextRotatorNotification,LETUP_CONFIG.rotatorInterval)},LETUP_CONFIG.autoHideDelay)}
window.addEventListener('beforeunload',()=>{if(realtimeSubscription){realtimeSubscription.unsubscribe()}
if(rotatorTimeout){clearTimeout(rotatorTimeout)}})
